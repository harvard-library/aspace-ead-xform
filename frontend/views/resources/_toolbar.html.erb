<%#
  If this file is changed in core, it must be updated here with our additions included.
  Our additions are the two script lines at the end.
%>

<% if user_can?('update_resource_record') %>

  <% unless content_for?(:exports) %>
    <% content_for :exports do %>
      <li class="dropdown-submenu" id="download-ead-dropdown" data-download-ead-url="<%= url_for(:controller => :exports,
        :action => :download_ead, :id => @resource.id, :include_unpublished => "${include_unpublished}",
        :include_daos => "${include_daos}", :numbered_cs => "${numbered_cs}", :print_pdf => "${print_pdf}",
        :ead3 => "${ead3}" )%>">
        <a href="#" data-toggle="dropdown" class="menu-with-options download-ead-action" title="<%= I18n.t("actions.export_ead") %>"><%= I18n.t("actions.export_ead") %></a>
        <div class="dropdown-menu" id="form_download_ead">
          <fieldset>
            <input type="hidden" name="id", value="<%= @resource.id %>" />
            <label class="checkbox" for="include-unpublished">
              <input type="checkbox" id="include-unpublished" name="include_unpublished" checked="checked"/>
              <%= I18n.t("export_options.include_unpublished") %>&#160;
            </label>
            <label class="checkbox" for="include-daos">
              <input type="checkbox" id="include-daos" name="include_daos" checked="checked"/>
              <%= I18n.t("export_options.include_daos") %>&#160;
            </label>
            <label class="checkbox" for="numbered-cs">
              <input type="checkbox" id="numbered-cs" name="numbered_cs" />
              <%= I18n.t("export_options.numbered_cs") %>&#160;
            </label>
            <%# EAD3 %>
            <label class="checkbox" for="ead3">
              <input type="checkbox" id="ead3" name="ead3" />
              <%= I18n.t("export_options.ead3") %>&#160;
            </label>
            <%# END - EAD3 %>
          </fieldset>
        </div>
      </li>

      <li class="dropdown-submenu" id="download-marc-dropdown" data-download-marc-url="<%= url_for(:controller => :exports, :action => :download_marc, :id => @resource.id, :include_unpublished_marc => "${include_unpublished_marc}")%>">
        <a href="#" data-toggle="dropdown" class="menu-with-options download-marc-action" title="<%= I18n.t("actions.export_marc") %>"><%= I18n.t("actions.export_marc") %></a>
        <div class="dropdown-menu" id="form_download_marc">
          <fieldset>
            <input type="hidden" name="id", value="<%= @resource.id %>" />
            <label class="checkbox" for="include-unpublished-marc">
              <input type="checkbox" id="include-unpublished-marc" name="include_unpublished_marc" checked="checked"/>
              <%= I18n.t("export_options.include_unpublished") %>&#160;
            </label>
            <%# END - MARC %>
          </fieldset>
        </div>
      </li>


      <li><%= link_to I18n.t("actions.container_labels"), {:controller => :exports, :action => :container_labels, :id => @resource.id}, :id => 'container-labels-link', :target => "_blank" %></li>

      <% if user_can?('create_job') %>
        <% if job_types['print_to_pdf_job']['create_permissions'].reject{|perm| user_can?(perm)}.empty? %>

            <%= form_for :job, :url => {:controller => :jobs, :action => :create} do |f| %>

              <!-- This is just cheating a little to make the style right -->
              <div class="dropdown-menu" style="all: unset">

                <li class="dropdown-submenu">
                  <a href="#" data-toggle="dropdown" class="menu-with-options">
                    <%= f.submit I18n.t("actions.print_to_pdf"), :style => 'all: unset;' %>
                  </a>
                  <div class="dropdown-menu">
                    <fieldset>
                      <%= f.hidden_field :source, :value => @resource.uri %>
                      <%= f.hidden_field :jsonmodel_type, :value => "print_to_pdf_job" %>
                      <%= f.hidden_field :job_type, :value => 'print_to_pdf_job' %>
                      <label class="checkbox" for="include-unpublished-pdf">
                        <%= f.check_box :include_unpublished, :checked => true %>
                        <%= I18n.t("export_options.include_unpublished") %>&#160;
                      </label>
                    </fieldset>
                  </div>
                </li>
            </div>
            <% end %>
          </li>

        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <%= render_aspace_partial(:partial => '/shared/resource_toolbar',
             :locals => {
              :record_type => 'resource',
              :record => @resource,
             })
  %>

  <script>var ead_xform_id = <%= params[:id] %>;</script>
  <%= javascript_include_tag "#{@base_url}/assets/ead_xform.js" %> 
<% end %>
